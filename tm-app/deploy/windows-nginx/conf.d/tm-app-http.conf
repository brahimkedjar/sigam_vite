## HTTP server for tm-app (static client + proxied API)

server {
    listen       80;
    server_name  _;

    # Point this to your built client directory
    # Use forward slashes on Windows paths
    root  C:/path/to/repo/tm-app/client/dist;
    index index.html;

    # Logs specific to tm-app
    access_log  logs/tm-app.access.log;
    error_log   logs/tm-app.error.log;

    include snippets/gzip.conf;
    include snippets/security-headers.conf;

    # Match server body size limit with NestJS limits (100mb in main.ts)
    client_max_body_size 100m;

    # Cache static assets aggressively (filenames are hashed in prod builds)
    location ~* \.(?:js|mjs|css|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|otf)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # App shell routing for SPA
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API proxy (NestJS runs on http://127.0.0.1:4000 with prefix /api)
    location /api/ {
        include     snippets/proxy.conf;
        proxy_pass  http://127.0.0.1:4000;
    }

    # Server-served static (proxied to Node as defined in server/src/main.ts)
    location /static/permis_templates/ {
        include     snippets/proxy.conf;
        proxy_pass  http://127.0.0.1:4000;
    }

    # Simple health check
    location /nginx-health {
        return 200 'ok';
        add_header Content-Type text/plain;
    }
}
